# Local DeepSeek OCR

完全ローカル環境で動作する、OllamaとDeepSeek-OCRモデルを利用した自炊（書籍電子化）支援アプリです。
画像からテキストを抽出し、プライバシーを守りながら高精度なOCRを実行できます。

## 特徴

- **完全ローカル動作**: インターネット接続不要で、データが外部に送信されることはありません。
- **DeepSeek-OCR**: 高性能な視覚言語モデルを使用し、日本語を含む多言語のテキスト認識が可能です。
- **シンプルでモダンなUI**: ドラッグ＆ドロップで簡単に画像やPDFをアップロードし、結果をすぐに確認できます。
- **PDFサポート**: 複数ページのPDFにも対応し、各ページを個別または一括でOCR処理できます。
- **全ページOCR**: PDFの全ページを一括処理し、自動的に各ページの結果を結合します。
- **繰り返し検出**: モデルが同じ文章を繰り返し生成した場合、自動的にOCRを停止してエラーを防ぎます。
- **モデル選択**: 設定画面でOllamaの任意のモデルを選択して使用できます。

## 前提条件

このアプリを使用するには、以下のソフトウェアが必要です。

1.  **Ollama**: ローカルでAIモデルを実行するためのツール。
    - [公式サイトからダウンロード](https://ollama.com/download)してインストールしてください。
2.  **Node.js**: アプリを実行するためのランタイム。
    - [公式サイト](https://nodejs.org/)から推奨版（LTS）をインストールしてください。

## セットアップ手順

1.  **Ollamaの準備**:
    ターミナル（コマンドプロンプト）を開き、以下のコマンドを実行してOCR用モデルをダウンロードします。
    ```bash
    ollama pull deepseek-ocr:3b
    ```
    ※ `deepseek-ocr:3b` が利用できない場合は、`deepseek-vl` などを試してください。

2.  **アプリのインストール**:
    このプロジェクトのフォルダでターミナルを開き、依存関係をインストールします。
    ```bash
    npm install
    ```

## 使い方

1.  **アプリの起動**:
    以下のコマンドでアプリを起動します。
    ```bash
    npm run dev
    ```
    または、`start.command` を実行（ダブルクリック）することでも起動できます。
    ```bash
    ./start.command
    ```
    Electronアプリのウィンドウが開きます。

2.  **画像またはPDFのアップロード**:
    - ウィンドウ中央のエリアに画像またはPDFファイルをドラッグ＆ドロップするか、「Browse Files」ボタンをクリックしてファイルを選択します。
    - 対応フォーマット: JPG, PNG, PDF
    - PDFファイルの場合、すべてのページがプレビュー表示され、OCRを実行したいページを選択できます。

3.  **PDFページの選択**（PDF使用時のみ）:
    - **単一ページ**: プレビューで目的のページを表示し、「Select This Page for OCR」ボタンをクリックします。
    - **全ページ一括処理**: 「OCR All Pages」ボタンをクリックすると、PDFの全ページを自動的に順番に処理します。
    - ページ下部のサムネイルをクリックして、任意のページをプレビューできます。

4.  **OCRの実行**:
    - 画像が表示されたら、右側のパネルにある「Run OCR」ボタンをクリックします。
    - テキストはリアルタイムで少しずつ表示されます（ストリーミング生成）。
    - 全ページOCRの場合、各ページの進行状況が表示されます（例：Processing page 2 of 10）。
    - 処理中に「Stop」ボタンをクリックすると、生成を中断できます。
    - 繰り返しパターンが検出された場合、自動的にOCRが停止します。

5.  **結果の利用**:
    - コピーアイコンをクリックして、テキストをクリップボードにコピーできます。
    - 保存アイコンをクリックして、結果をテキストファイルとして保存できます。

6.  **設定のカスタマイズ**（オプション）:
    - 左側のサイドバーで「Settings」をクリックします。
    - 使用するOllamaモデルを選択できます（例：deepseek-ocr、deepseek-vl など）。
    - 「Save Settings」をクリックして設定を保存します。

## トラブルシューティング

- **"Ollama Disconnected" と表示される**:
    - Ollamaがバックグラウンドで実行されているか確認してください。ターミナルで `ollama serve` を実行すると手動で起動できます。
- **OCR結果が出ない / エラーになる**:
    - モデルが正しくダウンロードされているか `ollama list` コマンドで確認してください。
    - メモリ不足の可能性があります。他の重いアプリケーションを終了してみてください。
- **"Repetition detected" エラーが表示される**:
    - これはモデルが同じ文章を繰り返し生成した場合に自動的に停止する機能です。
    - 画質が悪い、または複雑な画像の場合に発生することがあります。
    - より高品質な画像を使用するか、別のOllamaモデルを試してみてください。
- **全ページOCRの処理が途中で止まる**:
    - 繰り返し検出機能により自動停止した可能性があります。
    - それまでに処理されたページの結果は保持されているので、残りのページを個別に処理してください。

## ライセンス

MIT License
